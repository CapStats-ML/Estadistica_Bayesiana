
- Utilizar los resultados de agrupamiento para crear un diagrama de Sankey que muestre la evolución de los grupos a lo largo del tiempo.


library(networkD3)

# Crear los nodos: Departamentos y clústeres únicos
nodes <- data.frame(
  name = c(
    unique(unlist(lapply(l, function(df) df$dpto_ccdgo))),  # Departamentos únicos
    unique(unlist(lapply(l, function(df) df$Cluster)))      # Clústeres únicos
  )
)



# Crear los enlaces: Departamentos hacia clústeres
links <- do.call(rbind, lapply(1:length(l), function(i) {
  l[[i]] %>%
    mutate(
      source = match(dpto_ccdgo, nodes$name) - 1,  # Índice del departamento
      target = match(as.character(Cluster), nodes$name) - 1,  # Índice del clúster
      value = 1  # Cada enlace tiene un valor de 1
    ) %>%
    select(source, target, value)
}))

# Crear el marco de datos `departamentos` con códigos y nombres únicos
departamentos <- unique(cbind(dat$ESTU_COD_RESIDE_DEPTO, dat$ESTU_DEPTO_RESIDE))
colnames(departamentos) <- c("codigo", "nombre")

# Actualizar `nodes$name` para los departamentos
nodes$name[1:33] <- ifelse(
  nodes$name[1:33] %in% departamentos[, "codigo"],  # Si el nombre es un código de departamento
  departamentos[match(nodes$name[1:33], departamentos[, "codigo"]), "nombre"],  # Sustituir por el nombre
  nodes$name[1:33]  # Mantener los valores actuales (por ejemplo, clústeres)
)

# El resto del código sigue igual
sankey <- sankeyNetwork(
  Links = links,
  Nodes = nodes,
  Source = "source",
  Target = "target",
  Value = "value",
  NodeID = "name",
  fontSize = 12,
  nodeWidth = 30
)

# Mostrar el diagrama
sankey
